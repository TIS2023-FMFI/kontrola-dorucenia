{% extends 'base.html' %}

{% block title %} CEVA logistics {% endblock %}

{% block content %}
<section>
	<h2>Order details </h2>
	<p>Order number: {{req.order_code}}</p>
	<p>Booking reference: </p>
	<p>Supplier: </p>
	<p>Contact: </p>
	<p>Vehicle Reg No.: </p>
	<p>Customer: </p>
	<p>Loading: {% if res.loaded %} Vykonaná {% else %} Nevykonaná  {% endif %}</p>
	<p>Unloading: {% if res.unloaded %} Vykonaná {% else %} Nevykonaná  {% endif %}</p>
</section>

<section id="main_section">
	<section>
		<legend> Stav objednávky : <br><br>
			{% for ch in chat %}
			{{ ch.string }} <br><br>
			{% endfor %} </legend>
	</section>
	<h2>Status confirmation</h2>
	
	<section>
		<form method="post">
			<fieldset>
				<legend>The vehicle will arrive/arrived on time</legend>
				<p>I confirm the date and time of arrival for loading<br>
				<input type="checkbox" name="loaded" id="loaded" value="loaded" {% if res.loaded %}checked{% endif %}><label for="loaded">Loaded</label>
				<input type="submit" name="confirm_loading" id="confirm_loading" value="POTVRDIŤ NAKLÁDKU"></p>
				<hr>
				<p>I confirm the date and time of arrival for unloading<br>
				<input type="checkbox" name="unloaded" id="unloaded" value="unloaded" {% if res.unloaded %}checked{% endif %}><label for="unloaded">Unloaded</label>
				<input type="submit" name="confirm_unloading" id="confirm_unloading" value="POTVRDIŤ VYKLÁDKU"></p>
				
			</fieldset>
			
		</form>
	</section>

	<section>
		<form method="post">
			<fieldset>
				<legend>The vehicle will be late</legend>
				<p><label for="cause_delay">The cause of the delay:</label>
				<select name="cause_delay" id="cause_delay" required onchange="handleSelectChange()"></p>
					<option value=''>Select the cause for the delay</option>
					<option value="weather">Bad weather</option>
					<option value="broken_truck">Broken truck</option>
					<option value="accident">Car accident</option>
					<option value="delay_loading">Delay on the previous load</option>
					<option value="delay_unloading">Delay at the previous display</option>
					<option value="driver_performance">Driver performance</option>
					<option value="traffic_situation">Traffic situation</option>
					<option value="other">Another reason</option>
				</select>
				
				<p><label for="date">Estimated date and time of arrival:</label>
				<input type="date" name="date" id="date" size="20" required onchange="handleDateTimeChange()">
				<input type="time" name="time" id="time" size="20" required onchange="handleDateTimeChange()"></p>
				
				<p><label for="message">Comment:</label>
				<textarea name="message" id="message" rows="4" cols="20" required></textarea></p>
				
			</fieldset>
			<p><input type="submit" name="late_loading" id="late_loading" value="LATE FOR LOADING">
			<input type="submit" name="late_unloading" id="late_unloading" value="LATE FOR UNLOADING"></p>
		</form>
	</section>

</section>

<script>
var today = new Date();
var time = today.getHours() + ":" + (today.getMinutes() + 1);
var dd = today.getDate();
var mm = today.getMonth() + 1; 
var yyyy = today.getFullYear();

if (dd < 10) {
   dd = '0' + dd;
}

if (mm < 10) {
   mm = '0' + mm;
} 
	
today = yyyy + '-' + mm + '-' + dd;
document.getElementById("date").value = today;
document.getElementById("date").min = today;
document.getElementById("time").value = time;

function handleDateTimeChange() {
    var inputDate = document.getElementById("date").value;
    var inputTime = document.getElementById("time").value;

    var selectedDateTime = new Date(inputDate + " " + inputTime);
    var currentDateTime = new Date();

    if (selectedDateTime < currentDateTime) {
        alert("Nemožno zvoliť dátum a čas z minulosti. Zvoľte prosím budúci dátum a čas.");
		
        var currentTime = currentDateTime.getHours() + ":" + currentDateTime.getMinutes();
        document.getElementById("time").value = currentTime;
    }
}

function handleSelectChange() {
    var selectElement = document.getElementById("cause_delay");
	var textField = document.getElementById("message");

	if (selectElement.value === "other") {
		textField.setAttribute("required", "true");
	} else {
		textField.removeAttribute("required");
	}
}

</script>

{% endblock %}